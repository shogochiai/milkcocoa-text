# 後半

milkcocoa-syncではデータを同期することだけしかできませんでした。なぜなら、入門版として学習コスト無く扱える事だけを追求したバージョンだったからです。
次はmilkcocoa.js本体を用いて、より多彩な表現を行いましょう。

Kinect-jThree連携だけ学べれば良い方は読む必要はあまりないですが、これからの開発の幅を広げる便利な道具なので、ぜひとも読んでいただきたい内容です。

## milkcocoa-syncからmilkcocoaへ

### 何が変わるのか
1.保存/検索機能
　send関数だけでなく、pushやqueryといった関数が使えるようになります。データを保存したり、保存した事をリアルタイム同期したり、保存したデータを検索したりできることによって、ユーザーのデータを蓄積・利用できるようになります。
2.signup/signin機能
　アカウント作成・ログイン機能が使用できるようになります。ユーザーがログインしているか否かの情報をもとに表示するデータを切り分けることで、ユーザーごとに異なるサービスを提供できるようになります。
3.アクセス制限
　IPやログイン情報でデータへのアクセスを制御することで、悪意のある人物がサイト以外の場所からmilkcocoaを操作したり、ブラウザコンソールから無理矢理データにアクセスすることを防ぐことができます。

### 利点
1.簡単さ
開発にかかるコストが減るので、気持ち的に新しいことを始める際の抵抗がかなり少なくなります。
加えて、WEBサービス-アプリ-IoTデバイスの連携なども気軽に試そうという気になります。
相対的に他の人よりも新しい表現に高速に挑戦していけるので、より多くの学びと評価を得られます。

2.柔軟さ
単体ではできることが自前で作るWEBアプリケーションより少ないのは事実です。簡単さの代わりに犠牲にしたものは大きいです。しかし、組み合わせが可能です。NodeJSで利用可能なクライアントライブラリを用いればmilkcocoaのデータをサーバー上で利用したり同期したりできますので、milkcocoaで高速に始めたサービスを後から他の言語で作ったAPIサーバーとの連携してマイクロサービス的な作りにもできます。

### 欠点
1.firebaseとpubnubの管理画面を触る必要がある
　firebaseとpubnubを組み合わせて作られたmilkcocoaのインターフェースですが、保存したデータを一覧で見たりセキュリティを書ける際はfirebaseの管理画面にいかなければなりません。また、milkcocoa-syncの場合は初めからkeyが内包されているのでpubnubの管理画面に行く必要はありませんが、milkcocoaの場合はpubnubのpubkeyとsubkeyを管理画面で取得する必要があります。
2.一定のデータ量を超えるとアップグレードの必要がある
　firebaseとpubnubは無料のWEBアプリケーションを提供してくれます。しかし、サービスのトラフィックが増えると課金が必要になります。保存/検索のトラフィックが増えた場合はfirebaseに、データの同期のトラフィックが増えた場合はpubnubの課金が必要です。フロントエンドの作り方に依存してどちらのトラフィックが増えるかは変わりますのでお気をつけください。しかし開発コストを考えると課金額は割安だと思います。ちなみに、firebaseはGoogleに買収されていますし、pubnubはfirebase以上のデバイス数を日々捌いていますので、安定感は抜群です。
3.セキュリティに気を遣うと多少の学習コストがある
　本番環境でサービスを運営する際には、アプリケーションの種類によてはfirebase/pubnubの管理画面でデータストアに対するセキュリティルールをかけなければならない場合があります。その場合に穴がないようにセキュリティルールや許可オリジンを設定するには、多少のWEBセキュリティについての理解が必要になります。しかし、従来のWEB開発よりも塞ぐべき穴が少ないため、比較的労力は低いです。
4.jsonデータとして常に手動でバックアップをとらないとfirebaseに何かあったときにデータが消失する
　firebaseに保存されたデータは、管理画面からexportすることができます。しかし、これは自動化できないタスクなので、毎日毎時間バックアップを残すのには大変な労力がかかります。Googleを信頼するか、手動でバックアップをとるか、喪失したくないデータは別のDBに保存するかなどの判断が必要になりますので、BaaSを使うべきアプリケーションか否かの判断が必要になるときもあります。

## インターフェース

### MilkCocoaオブジェクト

`new MilkCocoa()`
データストアへの接続を確立し、通信に使うMilkCocoaオブジェクトのインスタンスを取得します。

`dataStore()`
データの保存や取得の命令を出すため、データストアとの通信を行うDataStoreオブジェクトを取得します。

`addAccount()`
新しいログインアカウントを作成します。

`login()`
ログインの処理を行います。

`logout()`
ログアウトの処理を行います。

`getCurrentUser()`
現在ログインしているユーザの情報を取得します。ユーザーのログイン・非ログインで表示する情報を切り分けるなどして利用します。

### DataStoreオブジェクト
`push()`
データストアに新しくデータを追加します。

`set()`
データストアの要素を変更します。

`remove()`
データストアからデータを削除します。

`send()`
データストアにデータを残さず、現在接続されているユーザーにデータを送信することができます。

`on()`
データストアへのイベントを登録します。

`off()`
データストアに登録されたイベントを解除します。

``


### Queryオブジェクト


## milkcocoaの具体的な使い方のパターン
- 一覧画面にはQuery
- データ保存にはpushかset
- 変更をリアルタイム同期したいならon（しなくてもいい）
- イベント同期したいならsend-onsendペア
- loginありサービスなら、getCurrentUserで表示を切り分け
- membersデータストアで管理者権限を実現する


## milkcocoa(および他のBaaS各社)が動く環境
iOS/Android
初めはサーバーサイドのことなんて考えないでいられる

サーバー(NodeJS)
エンジニア向けの、既存システムとの連携で工数削減できる

IoTデバイス
通信実装の苦労を考えずにメカデザインやサービスデザインに集中できる


## ブラウザベースWEBサービスとその先の可能性
- BaaSの醍醐味
	- 始めるときの心理障壁の低さ
	- 環境構築の楽さ
	- フロントエンドファーストで居られる良さ
	- デバイスを横断してデータが縦横無尽に行き交うアーキテクチャ
	- それらを呼吸をするように使える事

- 当然のようにWEBとモバイルとIoTを横断したアーキテクチャを考える未来
	- メディアアート
	- 自然な体験
	- 高速な仮説検証

# まとめ
